define(["jquery"],function(a){var b=5e3,c=1e3,d=6e4,e=6e4;return{setLoadVideoListTime:function(a){a=a},setOptions:function(a,b,c){a=a,b=b,c=c},initCodeCapture:function(c){var d=a.now(),e=new Array,f=function(){if(void 0==window.vpl_files)return setTimeout(f,b);for(var c=0;c<window.vpl_files.length;c++)void 0==window.vpl_files_log[c]&&(window.vpl_files_log[c]=new Array),e[c]!=window.vpl_files[c].getContent()&&(window.vpl_files_log[c].push({time:{from:d,to:a.now()},content:window.vpl_files[c].getContent(),fileName:window.vpl_files[c].getFileName()}),e[c]=window.vpl_files[c].getContent());d=a.now(),setTimeout(f,b)};a(window).load(function(){window.vpl_files_log=new Array,window.vpl_code_capture_enabled=!0,f()})},initScreenCapture:function(b,e,f,g){var h,i=!1,j=!1,k=a.now(),l=document.getElementById(b),m=document.createElement("canvas"),n=m.getContext("2d");m.width=l.clientWidth,m.height=l.clientHeight,m.style.top=0,m.style.left=0,m.style.zIndex=-1,(document.body||document.documentElement).appendChild(m),m.style.visibility="hidden",webrtcUtils.enableLogs=!1;var o=function(b){i&&(i=!1,j=!0,h.stopRecording(function(){var c=h.getBlob(),d=new FormData;d.append("video-filename","video.webm"),d.append("video-blob",c),d.append("action","savescreenrecord"),d.append("cmid",f),d.append("userid",g),a.ajax({url:e,data:d,processData:!1,contentType:!1,method:"POST"}).done(function(c){k=a.now(),b()}).fail(function(){}).always(function(){})}))},p=function(){if(!j)return i?void html2canvas(l,{grabMouse:!1,onrendered:function(a){n.clearRect(0,0,m.width,m.height),n.drawImage(a,0,0,m.width,m.height),setTimeout(p,c)}}):setTimeout(p,c)},q=function(){if(!j){if(!i)return setTimeout(q,d);a.now()-k>=d&&o(function(){r()}),setTimeout(q,d)}},r=function(){i||(j=!1,h=new RecordRTC(m,{type:"canvas"}),h.startRecording(),p(),q(),i=!0)};a(window).load(function(){r()}),a(window).blur(function(){o(function(){})}),a(window).unload(function(){o(function(){})}),a(window).focus(function(){r()})},initLiveStream:function(b,c,d,f,g,h,i){var j=null,k=0,l=[],m=h,n=!1,o=function(){l.length>k?(j.src=d+"&id="+l[k],j.play(),k++):n=!1},p=function(){a.ajax({url:c,data:{action:"listlivestreamvideoids",sincetime:m,vpl:f,userid:g},method:"POST"}).done(function(a){l=l.concat(a.videoids),m=a.newtime,n||a.videoids.length>0&&(n=!0,o())}),setTimeout(p,e)};a(window).load(function(){j=document.getElementById(b),j.addEventListener("ended",function(a){o()}),i.length>0&&(l=i,n=!0,o()),p()})}}});